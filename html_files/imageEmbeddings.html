<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>imageembeddings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="imageEmbeddings_files/libs/clipboard/clipboard.min.js"></script>
<script src="imageEmbeddings_files/libs/quarto-html/quarto.js"></script>
<script src="imageEmbeddings_files/libs/quarto-html/popper.min.js"></script>
<script src="imageEmbeddings_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="imageEmbeddings_files/libs/quarto-html/anchor.min.js"></script>
<link href="imageEmbeddings_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="imageEmbeddings_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="imageEmbeddings_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="imageEmbeddings_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="imageEmbeddings_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">
  <div class="topnav">
    <ul style="padding: 0;">
      <li style="display: inline-block;"><a href="../index.html">Home</a>  </li>
      <li style="display: inline-block;"><a href="../Glyph/textEmbeddings.html">Text Embeddings</a>  </li>
      <li style="display: inline-block;"><a href="#">Image Embeddings</a>  </li>
      <li style="display: inline-block;"><a href="#">About Me</a></li>
    </ul>
  </div>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<h1>
Image Embeddings Notebook
</h1>
<p>In this notebook we will create embeddings for the images based on png files containing black and white versions of the letters in each script. Then we will cluster the embeddings, compare the clusters to rule-based clusters, and finally analyze specific rules and their relationship to the image embeddings clustering.</p>
<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import needed packages/functions</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># random seed for reproducibility</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>randomSeed <span class="op">=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>None of PyTorch, TensorFlow &gt;= 2.0, or Flax have been found. Models won't be available and only tokenizers, configuration and file/data utilities can be used.
None of PyTorch, TensorFlow &gt;= 2.0, or Flax have been found. Models won't be available and only tokenizers, configuration and file/data utilities can be used.</code></pre>
</div>
</div>
<section id="creating-image-embeddings" class="level2">
<h2 class="anchored" data-anchor-id="creating-image-embeddings">Creating Image Embeddings</h2>
<p>In order to create embeddings for the images (which were made using ImageForAllCharacter.py’), we will use the imgbeddings package.</p>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reading in all image files</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>allImages <span class="op">=</span> listdir(<span class="st">"character_images"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># making image embeddings</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="va">False</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># img embeddings model</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ibed <span class="op">=</span> imgbeddings()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># place to save embeddings</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    embeddings <span class="op">=</span> []</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># go through all images of characters and make embeddings</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> path <span class="kw">in</span> allImages:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(<span class="vs">r"character_images/"</span><span class="op">+</span>path)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        embedding <span class="op">=</span> ibed.to_embeddings(image)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        embeddings.append(embedding[<span class="dv">0</span>])</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save embeddings in dataframe</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(embeddings)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'Character'</span>] <span class="op">=</span> allImages</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save to a csv file</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    df.to_csv(<span class="st">'imageEmbeddings.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># read the csv embeddings once they are made</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'imageEmbeddings.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clustering-image-embeddings" class="level2">
<h2 class="anchored" data-anchor-id="clustering-image-embeddings">Clustering Image Embeddings</h2>
<p>Now that we have the image embeddings, we can cluster them using a clustering algorithm such as Kmeans (as used below). Inertias are shown, but there is no clear elbow so any analysis would have to choose a specific cluster number.</p>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># does clustering for all scripts together</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'imageEmbeddings.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>allScriptClusters <span class="op">=</span> doKmeans(df.drop(<span class="st">'Character'</span>,axis<span class="op">=</span><span class="dv">1</span>),<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">50</span>),<span class="va">True</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>allScriptClusters[<span class="st">'Character'</span>]<span class="op">=</span>df[<span class="st">'Character'</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>allScriptClusters.to_csv(<span class="st">'Clusters.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read the clusters from the saved file</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>allScriptClusters <span class="op">=</span> pd.read_csv(<span class="st">'Clusters.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For some kind of output, we can look at the clusters quickly by creating a file where each row contains a cluster with the characters in typed form. Unfortunately, some of the characters are not in most fonts and will therefore show up as boxes, but this is a quick way to look at the type of clustering done on the embeddings.</p>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creates text-based representation of the clusters in a text file (kmeans20.txt)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the rows are clusters and each value in a row is a character</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>charClusters <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>clusterNum <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"kmeans20.txt"</span>, <span class="st">"w"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># goes through each cluster</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster <span class="kw">in</span> <span class="bu">range</span>(clusterNum):</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    charClusters.append([])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># goes through each character in the cluster</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    chars <span class="op">=</span> []</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> allScriptClusters[allScriptClusters[<span class="st">"Kmeans "</span><span class="op">+</span><span class="bu">str</span>(clusterNum)]<span class="op">==</span>cluster][<span class="st">'Character'</span>]:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># gets indexes of the unicode</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        i1 <span class="op">=</span> char.index(<span class="st">"+"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        i2 <span class="op">=</span> char.index(<span class="st">"."</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># uses unicode to add the character</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">int</span>(<span class="st">"0x"</span><span class="op">+</span>char[i1<span class="op">+</span><span class="dv">1</span>:i2],<span class="dv">16</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        charClusters[cluster].append(<span class="bu">chr</span>(x))</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    f.write(<span class="st">','</span>.join(charClusters[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    f.write(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>f.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As well as clustering the images all together, we can cluster the images within each script. To do this, we need to extract the information regarding the script and unicode for each character from the image name, as seen below.</p>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determines the script IDs and unicodes based on the character col</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>scripts<span class="op">=</span>[]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>unicodes<span class="op">=</span>[]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> df[<span class="st">"Character"</span>]:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> line.index(<span class="st">'_'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    e <span class="op">=</span> line.index(<span class="st">'.'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    scripts.append(line[:s])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    unicodes.append(line[s<span class="op">+</span><span class="dv">1</span>:e])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># adds scripts and unicodes to the dataframe</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Script"</span>]<span class="op">=</span>scripts</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Unicode"</span>]<span class="op">=</span>unicodes</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># list of all the scripts</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>unique_scripts <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(scripts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can cluster based on each individual script and save each cluster set into a separate file in the imgClusters folder.</p>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creates kmeans clusters for each script individually</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># each file is saved in the imgClusters folder</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="va">False</span>):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># goes through each script</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> script <span class="kw">in</span> unique_scripts:</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># does kmeans for values 1-10 on the script</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> doKmeans(df[df[<span class="st">'Script'</span>]<span class="op">==</span>script].drop([<span class="st">'Character'</span>,<span class="st">"Script"</span>,<span class="st">"Unicode"</span>],axis<span class="op">=</span><span class="dv">1</span>),<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">10</span>),showIntertias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> pd.DataFrame()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        temp[<span class="st">'Character'</span>]<span class="op">=</span>df[df[<span class="st">'Script'</span>]<span class="op">==</span>script][<span class="st">'Character'</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        temp[<span class="st">"Script"</span>]<span class="op">=</span>df[df[<span class="st">'Script'</span>]<span class="op">==</span>script][<span class="st">'Script'</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        temp[<span class="st">"Unicode"</span>]<span class="op">=</span>df[df[<span class="st">'Script'</span>]<span class="op">==</span>script][<span class="st">'Unicode'</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">10</span>):</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            temp[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(i)]<span class="op">=</span>x[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(i)]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># saves the output to a file in the imgClusters folder</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        temp.to_csv(<span class="st">'imgClusters/kmeans_'</span><span class="op">+</span>script<span class="op">+</span><span class="st">'.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have clustered the letters for each script, we need to be able to visualize these clusters as seen below.</p>
<div id="cell-14" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># printing clusters for Mandaic</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> pd.read_csv(<span class="st">'/home/zoe/imgClusters/kmeans_6138ca71dc2a42003d45670e.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>num <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    showImgCluster(i, num,clusters,save<span class="op">=</span><span class="va">False</span>,show<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-9-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-9-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparing-clusters" class="level2">
<h2 class="anchored" data-anchor-id="comparing-clusters">Comparing Clusters</h2>
<p>The first step to compare the clusters is creating the rules clusters. We have two sets of data for the rules, one of which contains unique rules that were proposed by at least one person (threshold 1 data) and one that contains unique rules proposed by at least 5 people (threshold 5 data). The threshold 5 data is of higher quality, so we will use that data for the analyses.</p>
<div id="cell-16" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># makes kmeans files for all scripts in both t1 and t5</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>kmeansNums <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">10</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>makeRulesKmeans(<span class="st">'threshold1'</span>,kmeansNums,<span class="st">'ruleClusters_t1'</span>,randomSeed<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>makeRulesKmeans(<span class="st">'threshold5'</span>,kmeansNums,<span class="st">'ruleClusters_t5'</span>,randomSeed<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have both the rule-based clustering and the image embeddings clustering, we can compare the two clustering methods. Below we print out the cluster sets for Adlam script, first the rule-based clusters and then the image-based.</p>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shows rule-based clusters for Adlam t5</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>num <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>adlamt5 <span class="op">=</span> pd.read_csv(<span class="st">'ruleClusters_t5/kmeans_6138ca71dc2a42003d45673e.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                            </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num):</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    showImgCluster(i, num,adlamt5,save<span class="op">=</span><span class="va">False</span>,show<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-11-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows image-based clusters for Adlam</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>adlamClusters <span class="op">=</span> pd.read_csv(<span class="st">'/home/zoe/imgClusters/kmeans_6138ca71dc2a42003d45673e.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>num <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    showImgCluster(i, num,adlamClusters,save<span class="op">=</span><span class="va">False</span>,show<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-12-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In order to comprehensively compare the two types of clustering, we need a quantitative measure of similarity. For this purpose, I wrote a function to go through each letter pair and count the number of pairs that had the same status in both clusters (either in the same cluster or in different clusters) over the total number of pairs. It turns out that this method is called Random Index and is commonly used for comparing clustering methods. I double checked that my method worked the same as this one on the data.</p>
<div id="cell-21" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confirmation that both methods work the same!</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(countSame(<span class="bu">list</span>(adlamt5[<span class="st">'Unicode'</span>]),<span class="dv">6</span>,adlamt5,adlamClusters))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rand_score(adlamt5[<span class="st">'Kmeans 6'</span>],adlamClusters[<span class="st">'Kmeans 6'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.5926251097453907
0.5926251097453907</code></pre>
</div>
</div>
<p>Now we can run this analysis on all of the scripts, comparing clusters between the rule-based and image-embeddings. As well as using Rand Index (RI), we will also calculate the Adjusted Rand Index (ARI). The Adjusted Rand Index accounts for the chances that items are clustered together or apart by chance, and thus can give a more accurate representation of if the two clustering methods are related. There is some missing data for both rules and images for some scripts for various reasons, so those scripts (Afaka, Miao, Lisu, and Greek) will not be included in the analyses. Before running the analysis, we find the scripts that are not in both rules and images, and we re-sort the files to ensure that the rows line up properly.</p>
<div id="cell-23" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gets the lists of files for both image and rule clusters</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> listdir(<span class="st">'ruleClusters_t1'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> listdir(<span class="st">'imgClusters'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> x:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="kw">not</span> <span class="kw">in</span> y:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(a)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> y:</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="kw">not</span> <span class="kw">in</span> x:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(a)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Afaka and Miao are not in images</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Lisu and Greek are not in rules</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>kmeans_6138ca71dc2a42003d456786.csv
kmeans_6138ca71dc2a42003d456777.csv
kmeans_6138ca71dc2a42003d456732.csv
kmeans_6149eb71161b12003cbb0d48.csv</code></pre>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run to ensure all files are sorted correctly</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># goes through all files and sorts by unicode</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ensures the rows of the files line up for each script between rules and imgs</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> listdir(<span class="st">'ruleClusters_t1'</span>):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.read_csv(<span class="st">'ruleClusters_t1/'</span><span class="op">+</span><span class="bu">file</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Unicode'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    temp.to_csv(<span class="st">'ruleClusters_t1/'</span><span class="op">+</span><span class="bu">file</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> listdir(<span class="st">'ruleClusters_t5'</span>):</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.read_csv(<span class="st">'ruleClusters_t5/'</span><span class="op">+</span><span class="bu">file</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Unicode'</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    temp.to_csv(<span class="st">'ruleClusters_t5/'</span><span class="op">+</span><span class="bu">file</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> listdir(<span class="st">'imgClusters'</span>):</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.read_csv(<span class="st">'imgClusters/'</span><span class="op">+</span><span class="bu">file</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Unicode'</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    temp.to_csv(<span class="st">'imgClusters/'</span><span class="op">+</span><span class="bu">file</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># script info to convert between script ID and name</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>scriptDf <span class="op">=</span> pd.read_csv(<span class="st">'all-script-data.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans cluster num to use</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>clusterNum <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing lists</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>script_list <span class="op">=</span> []</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>scriptIDs <span class="op">=</span> []</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>rs <span class="op">=</span> []</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>ars <span class="op">=</span> []</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># goes through every script with image data</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fileName <span class="kw">in</span> listdir(<span class="st">'imgClusters'</span>):</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># skips the scripts without rules data</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fileName <span class="kw">in</span> [<span class="st">'kmeans_6138ca71dc2a42003d456732.csv'</span>,<span class="st">'kmeans_6149eb71161b12003cbb0d48.csv'</span>]:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reads in the clusters</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    rulet5 <span class="op">=</span> pd.read_csv(<span class="st">'ruleClusters_t5/'</span><span class="op">+</span>fileName)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> pd.read_csv(<span class="st">'imgClusters/'</span><span class="op">+</span>fileName)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gets the list of letters for the language</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    letters <span class="op">=</span> img[<span class="st">'Unicode'</span>]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    code <span class="op">=</span> fileName[fileName.index(<span class="st">'_'</span>)<span class="op">+</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">4</span>]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gets the name of the script</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    script_list.append(scriptDf[scriptDf[<span class="st">'ID'</span>]<span class="op">==</span>code].iloc[<span class="dv">0</span>][<span class="st">'Name'</span>])</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># saves the id of the script</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    scriptIDs.append(code)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># saves the rand score and adjusted rand score vals for the script</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    rs.append(rand_score(rulet5[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(clusterNum)],img[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(clusterNum)]))</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    ars.append(adjusted_rand_score(rulet5[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(clusterNum)],img[<span class="st">'Kmeans '</span><span class="op">+</span><span class="bu">str</span>(clusterNum)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then take all the information we just calculated and put it in a single dataframe for further analyses.</p>
<div id="cell-27" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>arsdf <span class="op">=</span> pd.DataFrame()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>arsdf[<span class="st">'Adjusted Rand Index'</span>]<span class="op">=</span>ars</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>arsdf[<span class="st">'Rand Index'</span>]<span class="op">=</span>rs</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>arsdf[<span class="st">'Script'</span>]<span class="op">=</span>script_list</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>arsdf[<span class="st">'Script ID'</span>]<span class="op">=</span>scriptIDs</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#arsdf = arsdf.sort_values(by='Adjusted Rand Index')</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>arsdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Adjusted Rand Index</th>
<th data-quarto-table-cell-role="th">Rand Index</th>
<th data-quarto-table-cell-role="th">Script</th>
<th data-quarto-table-cell-role="th">Script ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.167604</td>
<td>0.756989</td>
<td>Nabataean</td>
<td>6138ca71dc2a42003d456756</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.073016</td>
<td>0.691323</td>
<td>Old Permic</td>
<td>6138ca71dc2a42003d45672f</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.384194</td>
<td>0.800000</td>
<td>Mandaic</td>
<td>6138ca71dc2a42003d45670e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.001912</td>
<td>0.688889</td>
<td>Nyiakeng Puachue Hmong</td>
<td>6138ca71dc2a42003d456735</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.393701</td>
<td>0.857143</td>
<td>Phoenician</td>
<td>6138ca71dc2a42003d45674a</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Taking the information from above, we can look at first the relationship between the ARI and RI values to ensure there is nothing overtly weird going on with the data. The scatterplot shows a strong positive correlation between the two, which is what we would expect to see. Thus we move forward with the analysis.</p>
<div id="cell-29" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(arsdf[<span class="st">'Adjusted Rand Index'</span>],arsdf[<span class="st">'Rand Index'</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Then we can look at the distribution of ARI and RI scores via a boxplot. All of the RI values are positive, and almost all of the ARI scores are positive, indicating that there is correlation between the clusters created from the image embeddings and those created from the rules.</p>
<div id="cell-31" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.boxplot([arsdf[<span class="st">'Adjusted Rand Index'</span>],arsdf[<span class="st">'Rand Index'</span>]])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Adjusted Rand Index'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Score (-1 to 1)'</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Adjusted Rand Index'</span>,<span class="st">'Rand Index'</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Further analyses will ignore the RI values, as ARI is a more significant measure. To ensure that this correlation is significant, we perform a T-test on the ARI values, against a sample mean of 0 (which would indicate no correlation between the clusterings). Our t-test has a very significant p-value (p&lt;0.000001). Although the ARI scores are not super high for ARI, the repeated positive values for all scripts leads to the conclusion that there is significant correlation between the rule-based clusters and image embeddings clusters.</p>
<div id="cell-33" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ttest_1samp(arsdf[<span class="st">'Adjusted Rand Index'</span>],<span class="dv">0</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(arsdf[<span class="st">'Adjusted Rand Index'</span>].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TtestResult(statistic=9.925190281589817, pvalue=1.4033009579512519e-12, df=42)
count    43.000000
mean      0.185206
std       0.122363
min      -0.001912
25%       0.072587
50%       0.168039
75%       0.253719
max       0.464668
Name: Adjusted Rand Index, dtype: float64</code></pre>
</div>
</div>
<p>In an effort to further compare clusters, we performed PCA (keeping factors to explain 80% of the variance ratio) before kmeans and then again after to collapse down to 2D. We then scattered the data from each of the rule and image embeddings to compare. Unfortunately so far we have not found a method to map the data onto the same plane (since they use very different embedding types) so aside from visual comparing of the two, there is little we can do with this visualization.</p>
<div id="cell-35" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># choosing the script to analyze</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>script <span class="op">=</span> scriptIDs[<span class="dv">0</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get name and unicodes of the script</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> scriptDf[scriptDf[<span class="st">'ID'</span>]<span class="op">==</span>script][<span class="st">'Name'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(name)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>unicodes <span class="op">=</span> scriptDf[scriptDf[<span class="st">'ID'</span>]<span class="op">==</span>script][<span class="st">'Characters'</span>].iloc[<span class="dv">0</span>].split(<span class="st">','</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unicodes)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># list of the names of all the image files</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>imgNames <span class="op">=</span> []</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> code <span class="kw">in</span> unicodes:</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    imgNames.append(script<span class="op">+</span><span class="st">"_"</span><span class="op">+</span>code<span class="op">+</span><span class="st">".png"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># reads in all the embeddings necessary</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>imgEmbeddings <span class="op">=</span> pd.read_csv(<span class="st">'imageEmbeddings.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>scriptEmbeddings <span class="op">=</span> imgEmbeddings[imgEmbeddings[<span class="st">'Character'</span>].<span class="bu">str</span>.contains(script)]</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>ruleEmbeddings <span class="op">=</span> pd.read_csv(<span class="st">'threshold5/Letters_'</span><span class="op">+</span>name<span class="op">+</span><span class="st">'.csv'</span>,index_col<span class="op">=</span><span class="va">False</span>).drop([<span class="st">'Unicode'</span>,<span class="st">'Unnamed: 0'</span>],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># does pca on image-based embeddings</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA()</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>pca.fit_transform(scriptEmbeddings.drop(<span class="st">'Character'</span>,axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pca.explained_variance_ratio_</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the explained variance of each number of components</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(x)<span class="op">+</span><span class="dv">1</span>),x.cumsum(),marker<span class="op">=</span><span class="st">'o'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PCA component cumulative explained variance ratio (Image-based)"</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"# of components"</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative explained variance"</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co"># finding smallest number of features over 80% explained variance</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>img80percent <span class="op">=</span> <span class="bu">next</span>(i <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(x.cumsum()) <span class="cf">if</span> val <span class="op">&gt;</span> <span class="fl">0.8</span>)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># does pca on rule-based embeddings</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA()</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>pca.fit_transform(ruleEmbeddings)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pca.explained_variance_ratio_</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting the explained variance of each number of components</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(x)<span class="op">+</span><span class="dv">1</span>),x.cumsum(),marker<span class="op">=</span><span class="st">'o'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"PCA component cumulative explained variance ratio (Rule-based)"</span>)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"# of components"</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative explained variance"</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="co"># finding smallest number of features over 80% explained variance</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>rule80percent <span class="op">=</span> <span class="bu">next</span>(i <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(x.cumsum()) <span class="cf">if</span> val <span class="op">&gt;</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nabataean
['U+10880', 'U+10881', 'U+10882', 'U+10883', 'U+10884', 'U+10885', 'U+10886', 'U+10887', 'U+10888', 'U+10889', 'U+1088A', 'U+1088B', 'U+1088C', 'U+1088D', 'U+1088E', 'U+1088F', 'U+10890', 'U+10891', 'U+10892', 'U+10893', 'U+10894', 'U+10895', 'U+10896', 'U+10897', 'U+10898', 'U+10899', 'U+1089A', 'U+1089B', 'U+1089C', 'U+1089D', 'U+1089E']</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-21-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IMG EMBEDDINGS</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># collapsing down to 80% explained variance dimension</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span>img80percent,random_state<span class="op">=</span>randomSeed)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>pca.fit(scriptEmbeddings.drop(<span class="st">'Character'</span>,axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>collapsedImg <span class="op">=</span> pca.transform(scriptEmbeddings.drop(<span class="st">'Character'</span>,axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>collapsedImg <span class="op">=</span> pd.DataFrame(collapsedImg)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># using 5 clusters</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>imgKmeans <span class="op">=</span> fitKmeans(<span class="dv">5</span>,collapsedImg,randomSeed<span class="op">=</span>randomSeed).labels_</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># collapses to 2d for graphing</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>,random_state<span class="op">=</span>randomSeed)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>pca.fit(collapsedImg)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>script2 <span class="op">=</span> pca.transform(collapsedImg)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>script2 <span class="op">=</span> pd.DataFrame(script2)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># gets the unicodes and pulls together all needed info</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>unicodes <span class="op">=</span> pd.DataFrame(unicodes)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>reorganizedImg <span class="op">=</span> pd.DataFrame()</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>reorganizedImg[<span class="st">'Unicodes'</span>]<span class="op">=</span>unicodes[<span class="dv">0</span>]</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>reorganizedImg[<span class="st">'X'</span>]<span class="op">=</span>script2[<span class="dv">0</span>]</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>reorganizedImg[<span class="st">'Y'</span>]<span class="op">=</span>script2[<span class="dv">1</span>]</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>reorganizedImg[<span class="st">'Kmeans 5'</span>]<span class="op">=</span>imgKmeans</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>reorganizedImg[<span class="st">'Character'</span>]<span class="op">=</span>imgNames</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> []</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plots the data</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots()</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Image Embeddings Clusters'</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Feature 1'</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature 2'</span>)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>ax.scatter(reorganizedImg[<span class="st">'X'</span>], reorganizedImg[<span class="st">'Y'</span>], picker<span class="op">=</span><span class="va">True</span>,c<span class="op">=</span>reorganizedImg[<span class="st">'Kmeans 5'</span>])</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># gets all labels</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(reorganizedImg[<span class="st">'Unicodes'</span>]):</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    texts.append(ax.text(reorganizedImg[<span class="st">'X'</span>].iloc[i], reorganizedImg[<span class="st">'Y'</span>].iloc[i], label,fontsize<span class="op">=</span><span class="dv">7</span>))  <span class="co"># Set alpha=0 to hide the labels initially</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># moves labels so they aren't overlapping as much as possible</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># can use avoid_self=True to stop text on top of points</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>adjust_text(texts,avoid_self<span class="op">=</span><span class="va">True</span>, arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>, color<span class="op">=</span><span class="st">'r'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(texts))</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="co"># RULE EMBEDDINGS</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="co"># collapsing down to 80% explained variance dimension</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>pca<span class="op">=</span>PCA(n_components<span class="op">=</span>rule80percent,random_state<span class="op">=</span>randomSeed) <span class="co"># for rule embeddings</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>pca.fit(ruleEmbeddings)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>collapsedRule <span class="op">=</span> pca.transform(ruleEmbeddings)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>collapsedRule <span class="op">=</span> pd.DataFrame(collapsedRule)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>ruleKmeans <span class="op">=</span> fitKmeans(<span class="dv">5</span>,collapsedRule,randomSeed<span class="op">=</span>randomSeed).labels_</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="co"># collapses to 2d for graphing</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>,random_state<span class="op">=</span>randomSeed)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>pca.fit(collapsedRule)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>script2 <span class="op">=</span> pca.transform(collapsedRule)</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>script2 <span class="op">=</span> pd.DataFrame(script2)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="co"># resets and organizes all info</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> []</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>reorganizedRule <span class="op">=</span> pd.DataFrame()</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>reorganizedRule[<span class="st">'Unicodes'</span>]<span class="op">=</span>unicodes[<span class="dv">0</span>]</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>reorganizedRule[<span class="st">'X'</span>]<span class="op">=</span>script2[<span class="dv">0</span>]</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>reorganizedRule[<span class="st">'Y'</span>]<span class="op">=</span>script2[<span class="dv">1</span>]</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>reorganizedRule[<span class="st">'Kmeans 5'</span>]<span class="op">=</span>ruleKmeans</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>reorganizedRule[<span class="st">'Character'</span>]<span class="op">=</span>imgNames</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="co">#reorganized = reorganized.sort_values(by='Kmeans 5')</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="co"># plots the data</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots()</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Rule-based Clusters'</span>)</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Feature 1'</span>)</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature 2'</span>)</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>ax.scatter(reorganizedRule[<span class="st">'X'</span>], reorganizedRule[<span class="st">'Y'</span>], picker<span class="op">=</span><span class="va">True</span>,c<span class="op">=</span>reorganizedRule[<span class="st">'Kmeans 5'</span>])</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="co"># gets all labels</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, label <span class="kw">in</span> <span class="bu">enumerate</span>(reorganizedRule[<span class="st">'Unicodes'</span>]):</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>    texts.append(ax.text(reorganizedRule[<span class="st">'X'</span>].iloc[i], reorganizedRule[<span class="st">'Y'</span>].iloc[i], label,fontsize<span class="op">=</span><span class="dv">7</span>))  <span class="co"># Set alpha=0 to hide the labels initially</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="co"># moves labels so they aren't overlapping as much as possible</span></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="co"># can use avoid_self=True to stop text on top of points</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>adjust_text(texts,avoid_self<span class="op">=</span><span class="va">True</span>, force_explode<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>),force_pull<span class="op">=</span>(<span class="fl">0.001</span>,<span class="fl">0.001</span>),arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>, color<span class="op">=</span><span class="st">'r'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(texts))</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>31
31</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-22-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment below in order to see the character clusters associated with the unicodes/clusters in the above graphs</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First 5 are image embeddings clusters</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Second 5 are rule-based clusters</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">'''clusterNum = 5</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(clusterNum):</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">    showImgCluster(i,clusterNum,reorganizedImg)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(5):</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">    showImgCluster(i,clusterNum,reorganizedRule)'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>'clusterNum = 5\nfor i in range(clusterNum):\n    showImgCluster(i,clusterNum,reorganizedImg)\nfor i in range(5):\n    showImgCluster(i,clusterNum,reorganizedRule)'</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This was used to clean up some of the files when they obtained unneccessary columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">'''for fileName in listdir('imgClusters'):</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    if fileName in ['kmeans_6138ca71dc2a42003d456732.csv','kmeans_6149eb71161b12003cbb0d48.csv']:</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">        continue</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    img = pd.read_csv('imgClusters/'+fileName)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    img=img.drop(['Unnamed: 0.5','Unnamed: 0.4','Unnamed: 0.3','Unnamed: 0.2','Unnamed: 0.1','Unnamed: 0'],axis=1)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    img.to_csv('imgClusters/'+fileName,index=False)'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>"for fileName in listdir('imgClusters'):\n    if fileName in ['kmeans_6138ca71dc2a42003d456732.csv','kmeans_6149eb71161b12003cbb0d48.csv']:\n        continue\n    img = pd.read_csv('imgClusters/'+fileName)\n    img=img.drop(['Unnamed: 0.5','Unnamed: 0.4','Unnamed: 0.3','Unnamed: 0.2','Unnamed: 0.1','Unnamed: 0'],axis=1)\n    img.to_csv('imgClusters/'+fileName,index=False)"</code></pre>
</div>
</div>
</section>
<section id="individual-rule-analysis" class="level2">
<h2 class="anchored" data-anchor-id="individual-rule-analysis">Individual Rule Analysis</h2>
<p>Now that we have confirmed that there is correlation between the image embeddings clusters and rule-based clusters, we are interested in which of the rules are most correlated with the image embeddings. To answer this question, we need a different set of data, since the current rule-based data only includes the binary and not a description of the rule.</p>
<p>The new data has descriptions of each rule and is located in the generalRuleData folder. It needs to be cleaned, and the cleaned versions are stored in generalRuleData2 with only the necessary information for each rule (binary string and description). A couple of the data files in the generalRuleData folder could not be read properly (Tagbanwa, Old Permic, and Afaka), and so are not included in the analysis.</p>
<div id="cell-40" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DATA CLEANING</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># invalid binary: Tagbanwa, Old Permic, Afaka</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># goes through each file in the data for cleaning</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> listdir(<span class="st">'generalRuleData'</span>):</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># skips the invalid files</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Afaka"</span> <span class="kw">in</span> <span class="bu">file</span>:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Tagbanwa"</span> <span class="kw">in</span> <span class="bu">file</span>:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Old Permic"</span> <span class="kw">in</span> <span class="bu">file</span>:</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(file)</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reads as csv if csv format</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'.csv'</span> <span class="kw">in</span> <span class="bu">file</span>:</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        csv <span class="op">=</span> pd.read_csv(<span class="st">'generalRuleData/'</span><span class="op">+</span><span class="bu">file</span>,delimiter<span class="op">=</span><span class="st">';'</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reads excel files</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        csv <span class="op">=</span> pd.read_excel(<span class="st">'generalRuleData/'</span><span class="op">+</span><span class="bu">file</span>,index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># renames columns to all be uniform (RuleBinary, Description)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    csv <span class="op">=</span> csv.rename(columns<span class="op">=</span>{<span class="st">"Rule.Binary"</span>:<span class="st">"RuleBinary"</span>,<span class="st">"BinaryRule"</span>:<span class="st">"RuleBinary"</span>,<span class="st">"Binary.Rule"</span>:<span class="st">"RuleBinary"</span>,<span class="st">"Binary code"</span>:<span class="st">"RuleBinary"</span>})</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    csv <span class="op">=</span> csv.rename(columns<span class="op">=</span>{<span class="st">"AlineDescription"</span>:<span class="st">"Description"</span>,<span class="st">"SakulratDescription"</span>:<span class="st">"Description"</span>,<span class="st">"AgnesDescription"</span>:<span class="st">"Description"</span>})</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># isolates the needed columns</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    csv <span class="op">=</span> csv[[<span class="st">'RuleBinary'</span>,<span class="st">'Description'</span>]]</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># removes quotes from the RuleBinary column</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    csv[<span class="st">'RuleBinary'</span>] <span class="op">=</span> csv[<span class="st">'RuleBinary'</span>].<span class="bu">str</span>.replace(<span class="st">'"'</span>,<span class="st">''</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    csv[<span class="st">'RuleBinary'</span>] <span class="op">=</span> csv[<span class="st">'RuleBinary'</span>].<span class="bu">str</span>.replace(<span class="st">"'"</span>,<span class="st">''</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># saves the cleaned file as a csv in the generalRuleData2 folder</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'.csv'</span> <span class="kw">in</span> <span class="bu">file</span>:</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        csv.to_csv(<span class="st">'generalRuleData2/'</span><span class="op">+</span><span class="bu">file</span>,sep<span class="op">=</span><span class="st">';'</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        csv.to_csv(<span class="st">'generalRuleData2/'</span><span class="op">+</span><span class="bu">file</span>[:<span class="bu">file</span>.index(<span class="st">'.xlsm'</span>)]<span class="op">+</span><span class="st">'.csv'</span>,index<span class="op">=</span><span class="va">False</span>,sep<span class="op">=</span><span class="st">';'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the data is cleaned, we can go through each rule in each script and see how clustering the letters into two parts using the rule and using the image embeddings relate to each other. We calculate the ARI score for every rule in every script in contrast with the image embeddings clusters of 2 parts.</p>
<div id="cell-42" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checking ARI score for each rule</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># clusternum to use</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>clusterNum <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing lists</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>script_list <span class="op">=</span> []</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>scriptIDs <span class="op">=</span> []</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>rs <span class="op">=</span> []</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>ars <span class="op">=</span> []</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> listdir(<span class="st">'generalRuleData2'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframes to contain the most correlated and least correlated rules</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>top <span class="op">=</span> pd.DataFrame()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> pd.DataFrame()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># lists to hold all info from top 3 and bottom 3 rules per script</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>descs<span class="op">=</span>[]</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>scripts<span class="op">=</span>[]</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>kmeans2<span class="op">=</span>[]</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>places<span class="op">=</span>[]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># goes through each file in the image clusters</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fileName <span class="kw">in</span> listdir(<span class="st">'imgClusters'</span>):</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identifies the script id and script name</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> fileName[fileName.index(<span class="st">'_'</span>)<span class="op">+</span><span class="dv">1</span>:fileName.index(<span class="st">'.'</span>)]</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> scriptDf[scriptDf[<span class="st">'ID'</span>]<span class="op">==</span><span class="bu">id</span>][<span class="st">'Name'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reads in the cluster data for the images</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> pd.read_csv(<span class="st">'imgClusters/'</span><span class="op">+</span>fileName)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># finds the file with the rule data</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span> <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> files <span class="cf">if</span> name <span class="kw">in</span> s]</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># skips the script if there is no rule data</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">file</span> <span class="op">==</span> []:</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># makes the csv for the script with rule data</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> pd.read_csv(<span class="st">'generalRuleData2/'</span><span class="op">+</span><span class="bu">file</span>[<span class="dv">0</span>],delimiter<span class="op">=</span><span class="st">';'</span>,dtype<span class="op">=</span>{<span class="st">'RuleBinary'</span>:<span class="bu">str</span>})</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gets the unicodes associated with the script</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    unis <span class="op">=</span> scriptDf[scriptDf[<span class="st">'Name'</span>]<span class="op">==</span>name][<span class="st">'Characters'</span>].iloc[<span class="dv">0</span>].split(<span class="st">","</span>)</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># creates dataframe to collect all info</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    scriptData <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'Unicode'</span>,<span class="op">*</span><span class="bu">list</span>(temp[<span class="st">'Description'</span>])])</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> temp[<span class="st">'RuleBinary'</span>]</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(l)):</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>        scriptData[temp[<span class="st">'Description'</span>][row]] <span class="op">=</span> <span class="bu">list</span>(l[row])</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initializes lists to hold ARI score for 2 clusters and 5 clusters of img data</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    k2 <span class="op">=</span> []</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    k5 <span class="op">=</span> []</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculates the ARI scores</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> temp[<span class="st">'RuleBinary'</span>]:</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>        k2.append(adjusted_rand_score(<span class="bu">list</span>(row),img[<span class="st">'Kmeans 2'</span>]))</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>        k5.append(adjusted_rand_score(<span class="bu">list</span>(row),img[<span class="st">'Kmeans 5'</span>]))</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># collects the data in one df</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    temp[<span class="st">'Kmeans 2'</span>] <span class="op">=</span> k2</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    temp[<span class="st">'Kmeans 5'</span>] <span class="op">=</span> k5</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>    temp[<span class="st">'ID'</span>] <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    temp[<span class="st">'ScriptName'</span>] <span class="op">=</span> name</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Threshold for top correlated rules &gt; 0.4</span></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>    above2 <span class="op">=</span> temp[temp[<span class="st">'Kmeans 2'</span>]<span class="op">&gt;=</span><span class="fl">0.4</span>][[<span class="st">'Description'</span>,<span class="st">'Kmeans 2'</span>,<span class="st">'ScriptName'</span>,<span class="st">'ID'</span>]]</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> pd.concat([top,above2],ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Threshold for bottom correlated rules &lt; -0.1</span></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>    below0 <span class="op">=</span> temp[temp[<span class="st">'Kmeans 2'</span>]<span class="op">&lt;=-</span><span class="fl">0.1</span>][[<span class="st">'Description'</span>,<span class="st">'Kmeans 2'</span>,<span class="st">'ScriptName'</span>,<span class="st">'ID'</span>]]</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> pd.concat([bottom,below0],ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">all</span> <span class="op">=</span> [k2,k5]</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>    scriptPrinted <span class="op">=</span> <span class="va">False</span></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># does p-val significance tests on each script according to all the rules ARIs</span></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i,l <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">all</span>):</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># doesn't count the k5 clusters</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> ttest_1samp(l,<span class="dv">0</span>,alternative<span class="op">=</span><span class="st">'greater'</span>).pvalue</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prints the top 5 correlated rules for the significant scripts</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p<span class="op">&lt;</span><span class="fl">0.05</span>:</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> scriptPrinted:</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">------------------------------------'</span>)</span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Script: '</span><span class="op">+</span>name)</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>                scriptPrinted<span class="op">=</span><span class="va">True</span></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(i<span class="op">==</span><span class="dv">0</span>):</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>                temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Kmeans 2'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(temp[[<span class="st">'Description'</span>,<span class="st">'Kmeans 2'</span>]].head())</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span>(i<span class="op">==</span><span class="dv">1</span>):</span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>                temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Kmeans 5'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(temp[[<span class="st">'Description'</span>,<span class="st">'Kmeans 5'</span>]].head())</span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('List num: '+str(i))</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'p-val: '</span><span class="op">+</span><span class="bu">str</span>(p))</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>            counts[i]<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># saves data for top 2 and bottom 2 rules from each script</span></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp.sort_values(by<span class="op">=</span><span class="st">'Kmeans 2'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a>    top2 <span class="op">=</span> temp.iloc[:<span class="dv">2</span>]</span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># only saves if the top two are both above 0.2</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">min</span>(top2[<span class="st">'Kmeans 2'</span>])<span class="op">&lt;</span><span class="fl">0.2</span>:</span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a>    bottom2 <span class="op">=</span> temp.iloc[<span class="op">-</span><span class="dv">2</span>:]</span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a>    descs<span class="op">+=</span><span class="bu">list</span>(top2[<span class="st">'Description'</span>])</span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>    descs<span class="op">+=</span><span class="bu">list</span>(bottom2[<span class="st">'Description'</span>])</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>    scripts<span class="op">+=</span>[name,name,name,name]</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>    kmeans2<span class="op">+=</span><span class="bu">list</span>(top2[<span class="st">'Kmeans 2'</span>])</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>    kmeans2<span class="op">+=</span><span class="bu">list</span>(bottom2[<span class="st">'Kmeans 2'</span>])</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>    places<span class="op">+=</span><span class="bu">list</span>([<span class="st">'top'</span>,<span class="st">'top'</span>,<span class="st">'bottom'</span>,<span class="st">'bottom'</span>])</span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------
Script: Pracalit
                                         Description  Kmeans 2
8                 All characters have a right angle.  0.376064
5  Characters without an overhead horizontal stra...  0.330638
7  A straight horizontal and vertical line meet a...  0.330046
1  Can be written with a single continuous stroke...  0.068576
4  Contains at least one closed loop, small circl...  0.067456
p-val: 0.022694625088889458

------------------------------------
Script: Sora Sompeng
                                          Description  Kmeans 2
6                  Contains at least one right angle.  0.240000
4                  Lines without circles at the end.   0.093333
2   No enclosed elements, whitespace, shapes, area...  0.093333
14  A round shape on the top, with a slight curl t...  0.093333
5   No circles, curlicues, or round shapes in the ...  0.040000
p-val: 0.03247052524420015

------------------------------------
Script: Mongolian
                                          Description  Kmeans 2
2   Characters that are entirely below a horizonta...  0.416173
14  Characters starting at the left with a hook an...  0.341390
6   Characters that can be drawn with one continuo...  0.215252
1   Characters with a straight horizontal line at ...  0.163150
13  Characters with simple left hook, left "walkin...  0.160790
p-val: 0.03876886434736071

------------------------------------
Script: Batak
                                          Description  Kmeans 2
8     Characters with a convex stroke or arch on top.  0.205342
7   Characters with curved lines and dashes undern...  0.119684
12  Characters made with a single continuous line ...  0.075041
1   Characters or symbols with three horizontal lines  0.054472
5   Characters with enclosed spaces and closed loo...  0.049786
p-val: 0.016113690853595375

------------------------------------
Script: Shavian
                                          Description  Kmeans 2
10  Characters with sharp corners/angles/kinks/ben...  0.155707
8   Curves of characters are barely open and almos...  0.129684
2   Character has two parts touching the floor, wi...  0.100812
11  One straight line with a small arc at one end,...  0.073421
5                 Contains a vertical symmetry axis.&nbsp;  0.033478
p-val: 0.010594777785846369

------------------------------------
Script: Hangul
                                          Description  Kmeans 2
18  Characters that are written only in the upper ...  0.551971
7   Characters that contain an enclosed space or loop  0.264628
6   Characters that contain one or more curved, ro...  0.257320
3   Characters that contain one or more long verti...  0.229979
12  Characters that are composed of two identical ...  0.150843
p-val: 0.013728760082299713

------------------------------------
Script: Pau Cin Hau
                                          Description  Kmeans 2
10                            Have curved lines only.  0.441940
1   Characters with only straight lines, abscence ...  0.148124
2                   Characters with a diagonal line.   0.108004
3          Characters with a diagonal straight line.   0.070681
8   Characters that look like Latin alphabet letters.  0.065566
p-val: 0.01836413429905731

------------------------------------
Script: Runic
                                          Description  Kmeans 2
16       Symbols in pairs, with one containing a dot.  0.442371
17          Characters with at least one curved line.  0.430419
18  Elements are located to the right of the verti...  0.408944
14              Contains multiple disconnected parts.  0.299141
13  Characters with separate dots, containing a do...  0.278547
p-val: 0.014269547291016529

------------------------------------
Script: Adlam
                                         Description  Kmeans 2
4       Characters have lines that cross each other.  0.048236
6  Characters have a vertical line with a right a...  0.045106
3  Characters have two curves (up or down) and ma...  0.037079
0  Characters have roughly the shape of an "m" an...  0.017631
1  Characters have a horizontal line at the top a...  0.010570
p-val: 0.010353723565729615

------------------------------------
Script: Zanabazar Square
                                         Description  Kmeans 2
1  All characters have a flag-like mark in the to...  0.605750
6  Variations of the letter E in different orient...  0.490517
2     Contains elements with curved lines/segments.   0.251935
3     Characters contain curves or rounded elements.  0.195553
7      Characters with flagged and unflagged pairs.   0.153392
p-val: 0.04462181671309866

------------------------------------
Script: Ogham
                                          Description  Kmeans 2
1   Characters with small solid diamond dots on a ...  0.350309
11                           Single stroke characters  0.256293
9     Characters with parallel vertical lines or bars  0.180802
10            Characters with parallel vertical lines  0.180802
13   Characters with vertical lines and right angles   0.114307
p-val: 0.0495115137298399

------------------------------------
Script: Warang Citi
                                         Description  Kmeans 2
1  Characters with no ends, topologically equival...  0.223878
3  Characters that are symmetrical around a horiz...  0.187526
4  Characters that are symmetrical around a verti...  0.169361
5  Characters that have an axis of symmetry, eith...  0.105749
2  Characters with one or more closed loops or en...  0.060936
p-val: 0.023281867442259824

------------------------------------
Script: Meetei Mayek
                                          Description  Kmeans 2
10  Characters with a straight horizontal stroke a...  0.533864
9              Characters contain straight lines only  0.424112
7   Characters with a top that is not entirely fla...  0.345906
12                Characters with enclosed space/loop  0.275250
5   Characters without a top horizontal line or fl...  0.247506
p-val: 0.005135448287340411

------------------------------------
Script: Buginese
                                          Description  Kmeans 2
10  Characters contain a U shape on a diagonal or ...  0.294479
0        Characters have a double hump or wave shape.  0.292066
3   Characters have vertical symmetry, meaning the...  0.192705
5   Characters have three endpoint or extremum poi...  0.129730
9   Characters have a diagonal or oblique shape, o...  0.129730
p-val: 0.015800204969971192</code></pre>
</div>
</div>
<p>Now we have the top and bottom correlated rules for all the scripts, so we can analyze them and see what differences there are between the two groups.</p>
<div id="cell-44" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>top <span class="op">=</span> top.sort_values(by<span class="op">=</span><span class="st">'Kmeans 2'</span>,ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>top.to_csv(<span class="st">'topDescriptions.csv'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> top[<span class="st">'Description'</span>]:</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characters resembling an L (right-side up and upside down).
Contains lines which crossover (like a cross).
Characters with a curved top line (like a hat)
Characters consist of one smooth line with a single change of direction.&nbsp;
Characters represent the letter U or W 
Characters have dots
All characters have a flag-like mark in the top-right corner.
Characters are open at the top and shaped like a "U" or "W". They would be able to hold a substantial amount of fluid if filled from the top and are suitable for carrying water.
Characters that have an arc shape, connecting two vertical lines at a 90 degree angle
Characters that are written only in the upper part of a box or space.
Characters with a straight horizontal stroke at the bottom, or a flat bottom, and is used in font encoding
Variations of the letter E in different orientations and with embellishments. 
Characters that are topologically one line with no points or loops, no crossing or doubling back, and no kinks. 
Characters start with the 6 shape 
Contains a circle or oval shape. &nbsp;
Letters with a shape similar to the letter "y"
Symbols in pairs, with one containing a dot.
Have curved lines only.
Characters with at least one curved line.
Characters contain straight lines only
Characters that are entirely below a horizontal line.
A single line without loops or backtracking, with no more than two curves.
Elements are located to the right of the vertical line or dot. </code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> bottom.sort_values(by<span class="op">=</span><span class="st">'Kmeans 2'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>bottom.to_csv(<span class="st">'bottomDescriptions.csv'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> bottom[<span class="st">'Description'</span>]:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characters with duplicated elements in succession.&nbsp;
Each of these characters has an enclosed, non-crossed loop.&nbsp;
Contains multiple upward loops with a wave-like appearance.&nbsp;
Characters with a closed loop or knot.
Letters that have a mirror image that is symmetrical about a vertical axis
Characters that are mirrored or rotated pairs
Contains a full length diagonal line bottom left to top right.
Characters that are reflections of another character, symmetrical about a vertical axis
Characters that resemble the letter "e" or "E"
Characters that are symmetrical about an axis, either horizontally or vertically
All characters have two vertical legs and are open at the bottom
Characters contain a closed loop or oval shape
Characters contain a closed loop or enclosed space in the character or graph
Characters are composed of two identical curved elements with a protrusion to the right.
Loop on the left side, closed and uncrossed character, resembling Arabic numerals, including loops, and small closed shapes.
Characters that have a '2' or bass clef shape on the left side, with variations such as a small circle running into the shape or a looped finish.
Features a horizontal bar at the top, a vertical bar to the right, another to the left, and a bottom-left to top-right diagonal. 
Contains two or more separate elements.
Leaf-like enclosed shape or small enclosed space(s) off of a single vertical line connected to top, oriented to the left off the right vertical line.
Characters that do not have any straight lines within them
Includes shapes of V or W. 
A long, upward-right-moving stroke, with a wide base and a pointed tip. 
Characters that start with a closed loop with a curve to the right, resembling the numeral 6 written horizontally.
Characters that are either 7s or have a small horizontal line at the top and a vertical stroke. They may also have a small appendage at the top going from right to left. They may be in pairs with a size difference.
All characters have a wave or squiggle
Contains a closed loop.
Characters that are a straight vertical line with no base or hook at the bottom.
All characters contain intersecting lines
All characters contain 90 degree angles
Characters that do not have any enclosed shapes or spaces.
Characters that contain a small closed circular loop
Has a squiggle-like design with multiple variations of curved and straight lines.
Contains a w-squiggle.&nbsp;
Characters with a triangle shape at the top connected to a descending line.
Characters that have a detached extra symbol above or below the main line.
All characters start with a distinct upright 'U' shape and have a declination around it. 
A letter with two peaks at the top, resembling u, v and w.
All characters have a closed loop.
Contains an X shape, either as a character or graphically.
Characters that start with or include the shape of the numeral 2, with variations such as a long straight line at the bottom or marks on top or underneath.</code></pre>
</div>
</div>
<p>In general, the rules that show higher correlation with the image embeddings are those that mention the shape of the entire character, and focus on larger, simpler building blocks instead of a couple specific pieces of the character. Those at the bottom tend to be more complex amalgamations of features that don’t necessarily describe the entire character but rather a smaller section.</p>
<div id="cell-47" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span> <span class="op">=</span> pd.DataFrame()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>[<span class="st">'Description'</span>]<span class="op">=</span>descs</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>[<span class="st">'Kmeans 2'</span>]<span class="op">=</span>kmeans2</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>[<span class="st">'Script'</span>]<span class="op">=</span>scripts</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>[<span class="st">'Place'</span>]<span class="op">=</span>places</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>.to_csv(<span class="st">'allDescriptions.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All the rules collected in the “all” dataframe were rated on three different descriptions. The first was if the rule described the whole character or just part of the character (whole?). The second is if the rule described an aspect of the character—such as crossing lines, parallel lines, or symmetry—or a specific feature of the character—such as a circle, specific shape, or specific line—(aspect?). The last classification is if the rule is “simple” or not. Simple is defined as only describing one aspect or feature of the character, whereas a complex rule may have multiple stipulations for the character to be included in the rule’s scope. The ratings are found in the ruleClassification.csv file.</p>
<div id="cell-50" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mode</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> pd.read_csv(<span class="st">'ruleClassification.csv'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>wholeVals <span class="op">=</span> []</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>aspectVals <span class="op">=</span> []</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>simpleVals <span class="op">=</span> []</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index,row <span class="kw">in</span> temp.iterrows():</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''if row['Whole? (ZS)']==row['Whole? (CS)']==row['Whole? (LP)']:</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">        wholeVals.append(row['Whole? (ZS)'])</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    else:</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">        wholeVals.append(np.NaN)</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    if row['Aspect? (ZS)']==row['Aspect? (CS)']==row['Aspect? (LP)']:</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">        aspectVals.append(row['Aspect? (ZS)'])</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">    else:</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">        aspectVals.append(np.NaN)</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">    if row['Simple? (ZS)']==row['Simple? (CS)']==row['Simple? (LP)']:</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">        simpleVals.append(row['Simple? (ZS)'])</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">    else:</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">        simpleVals.append(np.NaN)'''</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    wholeVals.append(mode(<span class="bu">list</span>(row[[<span class="st">'Whole? (ZS)'</span>,<span class="st">'Whole? (CS)'</span>,<span class="st">'Whole? (LP)'</span>]])).mode)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    aspectVals.append(mode(<span class="bu">list</span>(row[[<span class="st">'Aspect? (ZS)'</span>,<span class="st">'Aspect? (CS)'</span>,<span class="st">'Aspect? (LP)'</span>]])).mode)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    simpleVals.append(mode(<span class="bu">list</span>(row[[<span class="st">'Simple? (ZS)'</span>,<span class="st">'Simple? (CS)'</span>,<span class="st">'Simple? (LP)'</span>]])).mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(wholeVals))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>temp[<span class="st">'Whole'</span>]<span class="op">=</span>wholeVals</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>temp[<span class="st">'Aspect'</span>]<span class="op">=</span>aspectVals</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>temp[<span class="st">'Simple'</span>]<span class="op">=</span>simpleVals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>80</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>topRules <span class="op">=</span> temp[temp[<span class="st">'Place'</span>]<span class="op">==</span><span class="st">'top'</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>bottomRules <span class="op">=</span> temp[temp[<span class="st">'Place'</span>]<span class="op">==</span><span class="st">'bottom'</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(topRules[<span class="st">'Whole'</span>].value_counts())</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bottomRules[<span class="st">'Whole'</span>].value_counts())</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(topRules[<span class="st">'Aspect'</span>].value_counts())</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bottomRules[<span class="st">'Aspect'</span>].value_counts())</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(topRules[<span class="st">'Simple'</span>].value_counts())</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bottomRules[<span class="st">'Simple'</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Whole
0.0    23
1.0    17
Name: count, dtype: int64
Whole
0.0    27
1.0    13
Name: count, dtype: int64
Aspect
1    21
0    19
Name: count, dtype: int64
Aspect
1    27
0    13
Name: count, dtype: int64
Simple
0.0    20
1.0    20
Name: count, dtype: int64
Simple
0.0    21
1.0    19
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>topAspect <span class="op">=</span> (topRules[topRules[<span class="st">'Aspect'</span>]<span class="op">==</span><span class="dv">1</span>])</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(topAspect[topAspect[<span class="st">'Whole'</span>]<span class="op">==</span><span class="dv">1</span>]))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>bottomAspect <span class="op">=</span> (bottomRules[bottomRules[<span class="st">'Aspect'</span>]<span class="op">==</span><span class="dv">1</span>])</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(bottomAspect[bottomAspect[<span class="st">'Whole'</span>]<span class="op">==</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9
11</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ttest_ind</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ttest_ind(topRules[<span class="st">'Whole'</span>],bottomRules[<span class="st">'Whole'</span>],nan_policy<span class="op">=</span><span class="st">"omit"</span>).pvalue)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ttest_ind(topRules[<span class="st">'Aspect'</span>],bottomRules[<span class="st">'Aspect'</span>],nan_policy<span class="op">=</span><span class="st">"omit"</span>).pvalue)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ttest_ind(topRules[<span class="st">'Simple'</span>],bottomRules[<span class="st">'Simple'</span>],nan_policy<span class="op">=</span><span class="st">"omit"</span>).pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.361946198569682
0.1751746830335688
0.8257225769705617</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>temp[<span class="st">'Kmeans 2'</span>] <span class="op">=</span> fitKmeans(<span class="dv">2</span>,temp[[<span class="st">'Whole'</span>,<span class="st">'Aspect'</span>,<span class="st">'Simple'</span>]],randomSeed<span class="op">=</span>randomSeed).labels_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="imageEmbeddings_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(temp[temp[<span class="st">'Kmeans 2'</span>]<span class="op">==</span><span class="dv">0</span>][<span class="st">'Place'</span>].value_counts())</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(temp[temp[<span class="st">'Kmeans 2'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'Place'</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Place
bottom    27
top       23
Name: count, dtype: int64
Place
top       17
bottom    13
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>